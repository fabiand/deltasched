<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>hello-wasm example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="assets/jquery-3.7.1.min.js"></script>
  </head>
  <body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<!-- wasm-pack build --target web -->
    <script type="module">

      function buildView(sched) {
        let view = $("#sched-view");
        $(sched.status.phases).each(function() {
          let phase = this
          console.log("Building phase " + this.name);
          $(phase.milestones).each(function() {
            let ms = this
            console.log("Building ms " + ms.name);
            let row = $(`<tr id=ms-${ms.alias}/>`)
            row.append($("<td/>").text(ms.name))
            let input = $("<input pattern='\\d{4}-\\d{1,2}-\\d{1,2}' />")
            input.change(function(n) {
              console.log(n)
              console.log(ms.due_date)
              ms.due_date = n.target.value
              console.log(ms.due_date)
            })
            row.append($("<td id=duedate/>").append(input.attr("placeholder", ms.due_date)))
            view.append(row);
          })
        });

      }

      import init, { WasmSched } from "./pkg/deltasched.js";
      init().then(() => {
      	const doc = new WasmSched()
        //doc.from_name("bar")
        doc.replan()
        let sched = JSON.parse(doc.as_json_string())
        $("#dst").text(JSON.stringify(sched, undefined, 2))
        buildView(sched);
      });
    </script>
    <form class="needs-validation">
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Phase</th>
          <th>Due Date</th>
        </tr>
       </thead>
      <tbody id="sched-view">
      </tbody>
    </table>
    <button>Replan</button>
    </form>
<hr />

    <pre id="dst">
    </pre>
  </body>
</html>

